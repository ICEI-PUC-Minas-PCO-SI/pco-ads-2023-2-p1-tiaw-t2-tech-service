document.addEventListener("DOMContentLoaded", function () {
  document
    .getElementById("submit-receberDados")
    .addEventListener("click", function () {
      receberdados();
      conferirCampo();
    });
});
function IniciarPagina() {
  criarVaga();
  conferirLocalStorage();
}

function receberdados() {
  let recuperarUsuario = JSON.parse(localStorage.getItem("usuario")) || {
    Vaga: [],
  };

  // Criar Vaga
  let nomeVaga = document.getElementById("vaga-nome").value;
  let siteVaga = document.getElementById("vaga-site").value;
  let descricaoVaga = document.getElementById("vaga-descricao").value;

  let novaVaga = {
    nomeVaga: nomeVaga,
    site: siteVaga,
    descricao: descricaoVaga,
    filtro: [],
    software: [],
  };

  // Filtro
  var checkboxesFiltro = document.getElementsByName("checkboxGroup");
  checkboxesFiltro = Array.from(checkboxesFiltro);

  checkboxesFiltro.forEach(function (presente) {
    if (presente.checked) {
      novaVaga.filtro.push(presente.value);
    } else {
      let tituloFiltro = document.getElementById("dados-filtros");
      tituloFiltro.setAttribute("style", "color : red");
      setTimeout(function () {
        tituloFiltro.removeAttribute("style");
      }, 3000);
    }
  });

  // Linguagens
  var checkboxLinguagens = document.getElementsByName("checkboxSoftware");
  checkboxLinguagens = Array.from(checkboxLinguagens);

  checkboxLinguagens.forEach(function (presente2) {
    if (presente2.checked) {
      novaVaga.software.push(presente2.value);
    }
  });

  if (recuperarUsuario.Vaga[0] === 0) {
    recuperarUsuario.Vaga[0].push(novaVaga);
  } else {
    recuperarUsuario.Vaga.push(novaVaga);
  }

  if (nomeVaga && siteVaga && descricaoVaga) {
    let ativarModal = document.getElementById("meuModal");
    let mensagemModal = document.getElementById("mensagem-confimacao");

    ativarModal.setAttribute("style", "display : block");
    mensagemModal.innerText = "Você deseja salvar seus dados ?";

    document
      .getElementById("btn-enviar")
      .addEventListener("click", function () {
        ativarModal.setAttribute("style", "display : none");
        localStorage.setItem("usuario", JSON.stringify(recuperarUsuario));
        setTimeout(function () {
          document.getElementById("vaga-nome").value = "";
          document.getElementById("vaga-site").value = "";
          document.getElementById("vaga-descricao").value = "";
          criarVaga();
        }, 3000);
      });
    document
      .getElementById("BTN-fechar")
      .addEventListener("click", function () {
        ativarModal.setAttribute("style", "display : none");
      });
  }
}

function conferirCampo() {
  //Entrada
  let nomeVaga = document.getElementById("vaga-nome");
  let siteVaga = document.getElementById("vaga-site");
  let descricaoVaga = document.getElementById("vaga-descricao");
  //Entrada

  //Campo Nome  Vaga
  if (!nomeVaga.value) {
    nomeVaga.setAttribute("style", "border : 4px solid red");
    setTimeout(() => {
      nomeVaga.removeAttribute("style");
    }, 3000);
  } else {
    nomeVaga.setAttribute("style", "border : 4px solid green");
    setTimeout(() => {
      nomeVaga.removeAttribute("style");
    }, 3000);
  }
  //Campo Site Vaga
  if (!siteVaga.value) {
    siteVaga.setAttribute("style", "border : 4px solid red");
    setTimeout(() => {
      siteVaga.removeAttribute("style");
    }, 3000);
  } else {
    siteVaga.setAttribute("style", "border : 4px solid green");
    setTimeout(() => {
      siteVaga.removeAttribute("style");
    }, 3000);
  }

  //Campo Descriçao VAGA
  if (!descricaoVaga.value) {
    descricaoVaga.setAttribute("style", "border : 4px solid red");
    setTimeout(() => {
      descricaoVaga.removeAttribute("style");
    }, 3000);
  } else {
    descricaoVaga.setAttribute("style", "border : 4px solid green");
    setTimeout(() => {
      descricaoVaga.removeAttribute("style");
    }, 3000);
  }
  //Modal

  if (!nomeVaga.value || !siteVaga.value || !descricaoVaga.value) {
    console.log("abriu");
    let modalMensagem = document.getElementById("meuModal-Servico");
    let mensagemModal = document.getElementById("paragraph-modal-serv");
    let tituloModal = document.getElementById("titulo-modal");
    document
      .getElementById("btn-fechar")
      .addEventListener("click", function () {
        modalMensagem.setAttribute("style", "display : none");
      });

    modalMensagem.setAttribute("style", "display : block");
    mensagemModal.setAttribute("style", "font-size: 1.5rem; color : red");
    mensagemModal.innerText = "Insira todos os dados de Criar Vagas";
    tituloModal.setAttribute("style", "color : yellow");
  }
}

function conferirLocalStorage() {
  let dadosLocal = localStorage.getItem("usuario");
  let vagaaDados;

  if (dadosLocal) {
    vagaaDados = JSON.parse(dadosLocal);
    console.log(vagaaDados);
  }
  return vagaaDados;
}

function criarVaga() {
  let tela = document.getElementById("vagas-criadas");
  let vagaHTML = "";
  let vagaaDados = conferirLocalStorage();
  console.log(vagaaDados);

  if (vagaaDados && vagaaDados.Vaga) {
    console.log(vagaaDados.Vaga);
    for (let i = 0; i < vagaaDados.Vaga.length; i++) {
      const vagaAtual = vagaaDados.Vaga[i];
      const vagaIMG = vagaaDados.imagem;
      console.log(vagaAtual);
      vagaHTML += `
      <div class="vaga-disponivel" data-identificador="${i}">
        <div class="div-img">
          <img src="${vagaIMG}" alt="Img-Usuario" class="img-vaga"/>
        </div>
        <div class="div-dadosVagas">
          <p class="paragraph-titulo"><strong>Nome da Vaga : </strong>${
            vagaAtual.nomeVaga
          }</p>
          <p class="paragraph-descricao"><strong>Descrição : </strong>${
            vagaAtual.descricao
          }</p>
          <p class="paragraph-filtro"><strong>Filtro : </strong>${vagaAtual.filtro.join(
            ", "
          )}</p>
          <p class="paragraph-software"><strong>Linguagens : </strong> ${vagaAtual.software.join(
            ", "
          )}</p>
          <p class="paragraph-site"><strong>Site : </strong>${
            vagaAtual.site
          }</p>
          <button class="button-vaga" onclick="removerVaga(${i})">Remover</button>
        </div>
      </div>`;
    }
  } else {
    console.log("Nenhum dado de vaga encontrado.");
  }
  tela.innerHTML = vagaHTML;
}
function removerVaga(identificador) {
  //Aqui ele pega o indetificado do botao
  const indice = parseInt(identificador);
  //Recupera o localStorage de conferirLocalStorage
  let vagaaDados = conferirLocalStorage();

  //Valida se o campo tem valor
  if (vagaaDados && vagaaDados.Vaga) {
    //Retira o elemento com splice (indice())
    vagaaDados.Vaga.splice(indice, 1);

    localStorage.setItem("usuario", JSON.stringify(vagaaDados));
  }

  const vagaParaRemover = document.querySelector(
    `.vaga-disponivel[data-identificador="${identificador}"]`
  );
  if (vagaParaRemover) {
    vagaParaRemover.remove();
  }
}
