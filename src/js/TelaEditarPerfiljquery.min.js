$(document).ready(function () {
  //Recuperando ID do usuario
  let params = new URLSearchParams(location.search);
  console.log(params);
  let idd = params.get("id");
  console.log(idd);
  let linkPerfil = document.getElementById("a-Perfil");
  let linkCarrosel = document.getElementById("a-carrossel");
  let linkCriar = document.getElementById("a-CriarVaga");
  let linkForum = document.getElementById("a-Forum");
  linkForum.href = `Forum.html?id=${idd}`;
  linkPerfil.href = `Perfil.Freelancer.html?id=${idd}`;
  linkCarrosel.href = `carrossel.html?id=${idd}`;
  linkCriar.href = `TelaCriarVagas.html?id=${idd}`;
  console.log(linkPerfil);

  //Recuperando ID do usuario
  let usuario = [
    {
      id: 0,
      login: "",
      senha: "",
      nome: "",
      sobre: "",
      curriculo: "",
      portfolio: "",
      imagem: "",
      servicos: [],
      Vaga: [],
    },
  ];
  let id = usuario[0].id;
  $("#submit-usuario").click(function () {
    let nome = $("#input-nome").val();
    let sobre = $("#textarea-sobre").val();
    let curriculo = $("#input-arquivo1").val();
    let portfolio = $("#input-arquivo2").val();
    let imagem = $("#input-img").val();
    do {
      if (nome === "") {
        $("#input-nome").css({
          border: "4px solid red",
        });
        $("#meuModal-Servico").modal("show");
        $(".modal-title-serv").css("color", "red").text("Aviso!!");
        $("#paragraph-modal-serv")
          .css({ color: "red", "font-size": "1.5rem" })
          .text("Insira o nome (OBRIGATÓRIO)");
        break;
      } else {
        $("#input-nome").css({
          border: "4px solid green",
          color: "green",
        });
      }
    } while (nome === "");
    setTimeout(function () {
      $("#input-nome").css({
        border: "",
        color: "",
      });
    }, 3000);

    if (sobre === "") {
      $("#textarea-sobre").css({
        border: "4px solid red",
        color: "red",
      });
    } else {
      $("#textarea-sobre").css({
        border: "4px solid green",
        color: "green",
      });
    }
    setTimeout(function () {
      $("#textarea-sobre").css({
        border: "",
        color: "",
      });
    }, 3000);

    if (curriculo === "") {
      $("#input-arquivo1").css({
        border: "4px solid red",
        color: "red",
      });
    } else {
      $("#input-arquivo1").css({
        border: "4px solid green",
        color: "green",
      });
    }
    setTimeout(function () {
      $("#input-arquivo1").css({
        border: "",
        color: "",
      });
    }, 3000);

    if (portfolio === "") {
      $("#input-arquivo2").css({
        border: "4px solid red",
        color: "red",
      });
    } else {
      $("#input-arquivo2").css({
        border: "4px solid green",
        color: "green",
      });
    }
    setTimeout(function () {
      $("#input-arquivo2").css({
        border: "",
        color: "",
      });
    }, 3000);

    if (imagem === "") {
      $("#input-img").css({
        border: "4px solid red",
        color: "red",
      });
    } else {
      $("#input-img").css({
        border: "4px solid green",
        color: "green",
      });
    }
    setTimeout(function () {
      $("#input-img").css({
        border: "",
        color: "",
      });
    }, 3000);
    let temPropriedadeVazia = false;
    if (nome !== "") {
      usuario[0].nome = nome;
      usuario[0].sobre = sobre;
      usuario[0].portfolio = portfolio;
      usuario[0].imagem = imagem;
      usuario[0].curriculo = curriculo;

      if (!nome || !sobre || !portfolio || !imagem || !curriculo) {
        temPropriedadeVazia = true;
      }

      if (temPropriedadeVazia) {
        $("#meuModal").modal("show");
        $("#paragraph-modal").text(
          "Alguns dados ainda não foram preenchidos. Deseja salvar mesmo assim?"
        );
      } else {
        $("#meuModal").modal("show");
        $("#paragraph-modal").text(
          "Todos os dados foram preenchidos. Deseja salvá-los?"
        );
      }
    }
  });

  $("#btn-seguir").click(function () {
    let conferLocal = JSON.parse(localStorage.getItem("usuario"));
    if (conferLocal) {
      for (let i = 0; i <= conferLocal.length; i++) {
        console.log("ola1");
        if (conferLocal[i].id == id) {
          console.log("ola");
          conferLocal[i] = usuario[id];
          console.log(conferLocal[i]);
          localStorage.setItem("usuario", JSON.stringify(conferLocal));
          setTimeout(function () {
            $("#meuModal").modal("hide");
            if (usuario[0].imagem == "") {
              $("#img-usuario").attr("src", "/src/imgs/avatarimg.png");
            } else {
              $("#img-usuario").attr("src", usuario[0].imagem);
            }
          }, 1000);

          $("input[type='text']").val("");
          $("input[type='text'], textarea").val("");
          break;
        }
      }
    } else {
      console.log("ola3");
      localStorage.setItem("usuario", JSON.stringify(usuario));
      setTimeout(function () {
        $("#meuModal").modal("hide");
        if (usuario[0].imagem == "") {
          $("#img-usuario").attr("src", "/src/imgs/avatarimg.png");
        } else {
          $("#img-usuario").attr("src", usuario[0].imagem);
        }
      }, 1000);

      $("input[type='text']").val("");
      $("input[type='text'], textarea").val("");
    }
  });

  $("#input-serv").click(function (event) {
    event.preventDefault();
    let novoTitulo = $("#titulo-serv").val();
    let novaDescricao = $("#descricao-serv").val();

    if (novoTitulo == "" || novaDescricao == "") {
      $("#meuModal-Servico").modal("show");
      $(".modal-title-serv").css("color", "red").text("Aviso!!");
      $("#paragraph-modal-serv")
        .css({ color: "red", "font-size": "1.5rem" })
        .text("Insira todos os dados");
    } else {
      if (usuario.servicos.length <= 4) {
        usuario.servicos.push({
          titulo: novoTitulo,
          descricao: novaDescricao,
        });

        $("#meuModal-Servico").modal("show");
        $(".modal-title-serv").css("color", "green").text("Sucesso");
        $("#paragraph-modal-serv")
          .css({ color: "green", "font-size": "1rem" })
          .text("Enviado ");

        setTimeout(function () {
          $(".dados-servicos input[type= 'text'], textarea").val("");
        }, 3000);
      } else {
        $("#meuModal-Servico").modal("show");
        $(".modal-title-serv").css("color", "red").text("Aviso!!");
        $("#paragraph-modal-serv")
          .css("color", "red")
          .text("Você execedeu a quantidade maxima de Serviços (4) ");
      }
      localStorage.setItem("usuario", JSON.stringify(usuario));
    }
  });
});
